{"ast":null,"code":"var _jsxFileName = \"/Users/jamieanderson/Desktop/client/src/App.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from 'react';\nimport Header from './Header';\nimport Footer from './Footer';\nimport Wallet from './Wallet';\nimport NewOrder from './NewOrder';\nimport AllOrders from './AllOrders';\nimport MyOrders from './MyOrders';\nimport AllTrades from './AllTrades';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst SIDE = {\n  BUY: 0,\n  SELL: 1\n};\n\nfunction App({\n  web3,\n  accounts,\n  contracts\n}) {\n  _s();\n\n  const [tokens, setTokens] = useState([]);\n  const [user, setUser] = useState({\n    accounts: [],\n    balances: {\n      tokenDex: 0,\n      tokenWallet: 0\n    },\n    selectedToken: undefined\n  });\n  const [orders, setOrders] = useState({\n    buy: [],\n    sell: []\n  });\n  const [trades, setTrades] = useState([]);\n  const [listener, setListener] = useState(undefined);\n\n  const getBalances = async (account, token) => {\n    const tokenDex = await contracts.dex.methods.traderBalances(account, web3.utils.fromAscii(token.ticker)).call();\n    const tokenWallet = await contracts[token.ticker].methods.balanceOf(account).call();\n    return {\n      tokenDex,\n      tokenWallet\n    };\n  };\n\n  const getOrders = async token => {\n    const orders = await Promise.all([contracts.dex.methods.getOrders(web3.utils.fromAscii(token.ticker), SIDE.BUY).call(), contracts.dex.methods.getOrders(web3.utils.fromAscii(token.ticker), SIDE.SELL).call()]);\n    return {\n      buy: orders[0],\n      sell: orders[1]\n    };\n  };\n\n  const listenToTrades = token => {\n    const tradeIds = new Set();\n    setTrades([]);\n    const listener = contracts.dex.events.NewTrade({\n      filter: {\n        ticker: web3.utils.fromAscii(token.ticker)\n      },\n      fromBlock: 0\n    }).on('data', newTrade => {\n      if (tradeIds.has(newTrade.returnValues.tradeId)) return;\n      tradeIds.add(newTrade.returnValues.tradeId);\n      setTrades(trades => [...trades, newTrade.returnValues]);\n    });\n    setListener(listener);\n  };\n\n  const selectToken = token => {\n    setUser({ ...user,\n      selectedToken: token\n    });\n  };\n\n  const deposit = async amount => {\n    await contracts[user.selectedToken.ticker].methods.approve(contracts.dex.options.address, amount).send({\n      from: user.accounts[0]\n    });\n    await contracts.dex.methods.deposit(amount, web3.utils.fromAscii(user.selectedToken.ticker)).send({\n      from: user.accounts[0]\n    });\n    const balances = await getBalances(user.accounts[0], user.selectedToken);\n    setUser(user => ({ ...user,\n      balances\n    }));\n  };\n\n  const withdraw = async amount => {\n    await contracts.dex.methods.withdraw(amount, web3.utils.fromAscii(user.selectedToken.ticker)).send({\n      from: user.accounts[0]\n    });\n    const balances = await getBalances(user.accounts[0], user.selectedToken);\n    setUser(user => ({ ...user,\n      balances\n    }));\n  };\n\n  const createMarketOrder = async (amount, side) => {\n    await contracts.dex.methods.createMarketOrder(web3.utils.fromAscii(user.selectedToken.ticker), amount, side).send({\n      from: user.accounts[0]\n    });\n    const orders = await getOrders(user.selectedToken);\n    setOrders(orders);\n  };\n\n  const createLimitOrder = async (amount, price, side) => {\n    await contracts.dex.methods.createLimitOrder(web3.utils.fromAscii(user.selectedToken.ticker), amount, price, side).send({\n      from: user.accounts[0]\n    });\n    const orders = await getOrders(user.selectedToken);\n    setOrders(orders);\n  };\n\n  useEffect(() => {\n    const init = async () => {\n      const rawTokens = await contracts.dex.methods.getTokens().call();\n      const tokens = rawTokens.map(token => ({ ...token,\n        ticker: web3.utils.hexToUtf8(token.ticker)\n      }));\n      const [balances, orders] = await Promise.all([getBalances(accounts[0], tokens[0]), getOrders(tokens[0])]);\n      listenToTrades(tokens[0]);\n      setTokens(tokens);\n      setUser({\n        accounts,\n        balances,\n        selectedToken: tokens[0]\n      });\n      setOrders(orders);\n    };\n\n    init();\n  }, []);\n  useEffect(() => {\n    const init = async () => {\n      const [balances, orders] = await Promise.all([getBalances(user.accounts[0], user.selectedToken), getOrders(user.selectedToken)]);\n      listenToTrades(user.selectedToken);\n      setUser(user => ({ ...user,\n        balances\n      }));\n      setOrders(orders);\n    };\n\n    if (typeof user.selectedToken !== 'undefined') {\n      init();\n    }\n  }, [user.selectedToken], () => {\n    listener.unsubscribe();\n  });\n\n  if (typeof user.selectedToken === 'undefined') {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 12\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    id: \"app\",\n    children: [/*#__PURE__*/_jsxDEV(Header, {\n      contracts: contracts,\n      tokens: tokens,\n      user: user,\n      selectToken: selectToken\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n      className: \"container-fluid\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col-sm-4 first-col\",\n          children: [/*#__PURE__*/_jsxDEV(Wallet, {\n            user: user,\n            deposit: deposit,\n            withdraw: withdraw\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 173,\n            columnNumber: 13\n          }, this), user.selectedToken.ticker !== 'DAI' ? /*#__PURE__*/_jsxDEV(NewOrder, {\n            createMarketOrder: createMarketOrder,\n            createLimitOrder: createLimitOrder\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 175,\n            columnNumber: 15\n          }, this) : null]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 172,\n          columnNumber: 11\n        }, this), user.selectedToken.ticker !== 'DAI' ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col-sm-8\",\n          children: [/*#__PURE__*/_jsxDEV(AllTrades, {\n            trades: trades\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 183,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(AllOrders, {\n            orders: orders\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(MyOrders, {\n            orders: {\n              buy: orders.buy.filter(order => order.trader.toLowerCase() === accounts[0].toLowerCase()),\n              sell: orders.sell.filter(order => order.trader.toLowerCase() === accounts[0].toLowerCase())\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 185,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 13\n        }, this) : null]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 163,\n    columnNumber: 5\n  }, this);\n}\n\n_s(App, \"Oi6KMWUTNGJErMFDY+oWhCEfwWI=\");\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/Users/jamieanderson/Desktop/client/src/App.js"],"names":["React","useState","useEffect","Header","Footer","Wallet","NewOrder","AllOrders","MyOrders","AllTrades","SIDE","BUY","SELL","App","web3","accounts","contracts","tokens","setTokens","user","setUser","balances","tokenDex","tokenWallet","selectedToken","undefined","orders","setOrders","buy","sell","trades","setTrades","listener","setListener","getBalances","account","token","dex","methods","traderBalances","utils","fromAscii","ticker","call","balanceOf","getOrders","Promise","all","listenToTrades","tradeIds","Set","events","NewTrade","filter","fromBlock","on","newTrade","has","returnValues","tradeId","add","selectToken","deposit","amount","approve","options","address","send","from","withdraw","createMarketOrder","side","createLimitOrder","price","init","rawTokens","getTokens","map","hexToUtf8","unsubscribe","order","trader","toLowerCase"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport Header from './Header';\nimport Footer from './Footer';\nimport Wallet from './Wallet';\nimport NewOrder from './NewOrder';\nimport AllOrders from './AllOrders';\nimport MyOrders from './MyOrders';\nimport AllTrades from './AllTrades';\n\nconst SIDE = {\n  BUY: 0,\n  SELL: 1,\n};\n\nfunction App({ web3, accounts, contracts }) {\n  const [tokens, setTokens] = useState([]);\n  const [user, setUser] = useState({\n    accounts: [],\n    balances: {\n      tokenDex: 0,\n      tokenWallet: 0,\n    },\n    selectedToken: undefined,\n  });\n  const [orders, setOrders] = useState({\n    buy: [],\n    sell: [],\n  });\n  const [trades, setTrades] = useState([]);\n  const [listener, setListener] = useState(undefined);\n\n  const getBalances = async (account, token) => {\n    const tokenDex = await contracts.dex.methods\n      .traderBalances(account, web3.utils.fromAscii(token.ticker))\n      .call();\n    const tokenWallet = await contracts[token.ticker].methods\n      .balanceOf(account)\n      .call();\n    return { tokenDex, tokenWallet };\n  };\n\n  const getOrders = async token => {\n    const orders = await Promise.all([\n      contracts.dex.methods\n        .getOrders(web3.utils.fromAscii(token.ticker), SIDE.BUY)\n        .call(),\n      contracts.dex.methods\n        .getOrders(web3.utils.fromAscii(token.ticker), SIDE.SELL)\n        .call(),\n    ]);\n    return { buy: orders[0], sell: orders[1] };\n  };\n\n  const listenToTrades = token => {\n    const tradeIds = new Set();\n    setTrades([]);\n    const listener = contracts.dex.events\n      .NewTrade({\n        filter: { ticker: web3.utils.fromAscii(token.ticker) },\n        fromBlock: 0,\n      })\n      .on('data', newTrade => {\n        if (tradeIds.has(newTrade.returnValues.tradeId)) return;\n        tradeIds.add(newTrade.returnValues.tradeId);\n        setTrades(trades => [...trades, newTrade.returnValues]);\n      });\n    setListener(listener);\n  };\n\n  const selectToken = token => {\n    setUser({ ...user, selectedToken: token });\n  };\n\n  const deposit = async amount => {\n    await contracts[user.selectedToken.ticker].methods\n      .approve(contracts.dex.options.address, amount)\n      .send({ from: user.accounts[0] });\n    await contracts.dex.methods\n      .deposit(amount, web3.utils.fromAscii(user.selectedToken.ticker))\n      .send({ from: user.accounts[0] });\n    const balances = await getBalances(user.accounts[0], user.selectedToken);\n    setUser(user => ({ ...user, balances }));\n  };\n\n  const withdraw = async amount => {\n    await contracts.dex.methods\n      .withdraw(amount, web3.utils.fromAscii(user.selectedToken.ticker))\n      .send({ from: user.accounts[0] });\n    const balances = await getBalances(user.accounts[0], user.selectedToken);\n    setUser(user => ({ ...user, balances }));\n  };\n\n  const createMarketOrder = async (amount, side) => {\n    await contracts.dex.methods\n      .createMarketOrder(\n        web3.utils.fromAscii(user.selectedToken.ticker),\n        amount,\n        side\n      )\n      .send({ from: user.accounts[0] });\n    const orders = await getOrders(user.selectedToken);\n    setOrders(orders);\n  };\n\n  const createLimitOrder = async (amount, price, side) => {\n    await contracts.dex.methods\n      .createLimitOrder(\n        web3.utils.fromAscii(user.selectedToken.ticker),\n        amount,\n        price,\n        side\n      )\n      .send({ from: user.accounts[0] });\n    const orders = await getOrders(user.selectedToken);\n    setOrders(orders);\n  };\n\n  useEffect(() => {\n    const init = async () => {\n      const rawTokens = await contracts.dex.methods.getTokens().call();\n      const tokens = rawTokens.map(token => ({\n        ...token,\n        ticker: web3.utils.hexToUtf8(token.ticker),\n      }));\n      const [balances, orders] = await Promise.all([\n        getBalances(accounts[0], tokens[0]),\n        getOrders(tokens[0]),\n      ]);\n      listenToTrades(tokens[0]);\n      setTokens(tokens);\n      setUser({ accounts, balances, selectedToken: tokens[0] });\n      setOrders(orders);\n    };\n    init();\n  }, []);\n\n  useEffect(\n    () => {\n      const init = async () => {\n        const [balances, orders] = await Promise.all([\n          getBalances(user.accounts[0], user.selectedToken),\n          getOrders(user.selectedToken),\n        ]);\n        listenToTrades(user.selectedToken);\n        setUser(user => ({ ...user, balances }));\n        setOrders(orders);\n      };\n      if (typeof user.selectedToken !== 'undefined') {\n        init();\n      }\n    },\n    [user.selectedToken],\n    () => {\n      listener.unsubscribe();\n    }\n  );\n\n  if (typeof user.selectedToken === 'undefined') {\n    return <div>Loading...</div>;\n  }\n\n  return (\n    <div id='app'>\n      <Header\n        contracts={contracts}\n        tokens={tokens}\n        user={user}\n        selectToken={selectToken}\n      />\n      <main className='container-fluid'>\n        <div className='row'>\n          <div className='col-sm-4 first-col'>\n            <Wallet user={user} deposit={deposit} withdraw={withdraw} />\n            {user.selectedToken.ticker !== 'DAI' ? (\n              <NewOrder\n                createMarketOrder={createMarketOrder}\n                createLimitOrder={createLimitOrder}\n              />\n            ) : null}\n          </div>\n          {user.selectedToken.ticker !== 'DAI' ? (\n            <div className='col-sm-8'>\n              <AllTrades trades={trades} />\n              <AllOrders orders={orders} />\n              <MyOrders\n                orders={{\n                  buy: orders.buy.filter(\n                    order =>\n                      order.trader.toLowerCase() === accounts[0].toLowerCase()\n                  ),\n                  sell: orders.sell.filter(\n                    order =>\n                      order.trader.toLowerCase() === accounts[0].toLowerCase()\n                  ),\n                }}\n              />\n            </div>\n          ) : null}\n        </div>\n      </main>\n      <Footer />\n    </div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}